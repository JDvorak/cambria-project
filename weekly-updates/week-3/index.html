<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Cambria, Week Three: Connection | Cambria Development Notes</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.73.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/cambria/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    <link href="/cambria/article.css"/>

    
      <link rel="stylesheet" href="/cambria/article.css">
    

    
      

    

    
    
    <meta property="og:title" content="Cambria, Week Three: Connection" />
<meta property="og:description" content="This week we joined the two ends of the chunnel. The problem and the solution met in the middle and now we have a working system performing migrations on top of Cambria!
Mostly.
We do indeed have a working end-to-end system, with a rudimentary developer experience that allows developers to write migrations in a simple lens language and have their data automatically migrated to and from that format in any client." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://inkandswitch.github.io/cambria/weekly-updates/week-3/" />
<meta property="article:published_time" content="2020-06-29T16:47:58-07:00" />
<meta property="article:modified_time" content="2020-06-29T16:47:58-07:00" />
<meta itemprop="name" content="Cambria, Week Three: Connection">
<meta itemprop="description" content="This week we joined the two ends of the chunnel. The problem and the solution met in the middle and now we have a working system performing migrations on top of Cambria!
Mostly.
We do indeed have a working end-to-end system, with a rudimentary developer experience that allows developers to write migrations in a simple lens language and have their data automatically migrated to and from that format in any client.">
<meta itemprop="datePublished" content="2020-06-29T16:47:58-07:00" />
<meta itemprop="dateModified" content="2020-06-29T16:47:58-07:00" />
<meta itemprop="wordCount" content="866">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cambria, Week Three: Connection"/>
<meta name="twitter:description" content="This week we joined the two ends of the chunnel. The problem and the solution met in the middle and now we have a working system performing migrations on top of Cambria!
Mostly.
We do indeed have a working end-to-end system, with a rudimentary developer experience that allows developers to write migrations in a simple lens language and have their data automatically migrated to and from that format in any client."/>

	
  </head>

  <body class="ma0 bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/cambria/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Cambria Development Notes
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        WEEKLY UPDATES
      </aside>
      <h1 class="f1 mt3 mb1">Cambria, Week Three: Connection</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-06-29T16:47:58-07:00">June 29, 2020</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>This week we joined the two ends of the chunnel. The problem and the solution met in the middle and now we have a working system performing migrations on top of Cambria!</p>
<p>Mostly.</p>
<p>We do indeed have a working end-to-end system, with a rudimentary developer experience that allows developers to write migrations in a simple lens language and have their data automatically migrated to and from that format in any client.</p>
<p>Of course, there are lots of missing pieces and problems, but we&rsquo;ll come back to them in a minute. Let&rsquo;s talk about how it works.</p>
<h2 id="cloudina-the-patch-converter">Cloudina: the patch-converter</h2>
<p>The last version of Chitin had two jobs &ndash; converting data from one format to another, and storing that data in a sort of ur-file which incorporated enough information to manifest any version on demand. This week, having realized that this was two jobs, Geoffrey split the library into two pieces. Chitin &ndash; which deals with the storage &ndash; and Cloudina, which handles lensing data back and forth from one place to the next.</p>
<p>The new version of Chitin is not a svelte and efficient system at all. When a client makes a change, it causes a JSON Patch to be emitted. Cloudina then converts that patch into a patch on all the other neighboring data formats it knows about, and then those convert again, and again, until every format has a corresponding write.</p>
<p>This model is much easier to reason about the correctness of than our previous design, at the cost of having an incredible amount of file bloat. Every document version ever recorded stores a full independent copy of every document, which is, uh, obviously wrong.</p>
<p>That said, we haven&rsquo;t worried too much about that problem because we know that efficient structure-sharing immutable data is a well-studied domain and we can probably draft off all that work to bring the size down. In other words, we suspect that although we have not implemented it, this is a low-risk problem to defer.</p>
<p>One other exciting thing about this change is that we&rsquo;re no longer converting whole documents but just <em>patches</em>. Patches have some limitations (though at the limit, you can always put a whole replacement document into a patch) but they have great potential to be very efficient in terms of network, compute, and storage once we sort out, the, er, network&hellip; compute&hellip; and&hellip; storage.</p>
<p>We&rsquo;re especially excited about Cloudina because it can be a very straightforward and accessible solution to a common problem. Perhaps it could even be of use independently, such as to folks who would like to solve the problem Stripe solved in their API. I suspect that if we can nail both the functionality and the developer experience, this could be a very useful tool to keep in the toolbelt of many developers.</p>
<h2 id="chitin-v-2-3-4-whos-counting-anyway">Chitin v&hellip; 2? 3? 4? Who&rsquo;s counting, anyway?</h2>
<p>This brings us back to the storage side of the equation. As you&rsquo;ll see in this week&rsquo;s demo, we wanted to wire the whole experience up end-to-end into a real Electron application that we actually use. (We&rsquo;re writing a simple issue tracker that we use to work on the project as our technology test-bed.)</p>
<p>Because we want to support arbitrarily far-apart versions of a program to share data, we decided to try storing the lens definitions themselves into the document. This means that a V1 document can run the lens described by the V5 app to &ldquo;upgrade&rdquo; its writes into a format that program can read, even though that code hadn&rsquo;t been imagined or implemented when it was written.</p>
<p>Pretty cool trick, right?</p>
<h2 id="show-me-the-money-lebowski">Show me the money, Lebowski!</h2>
<p>I think it&rsquo;s in this demo. You&rsquo;d better take a look.</p>


<div style="position: relative; padding-bottom: 64.98194945848375%; height: 0;"><iframe src="https://www.loom.com/embed/d7c7548afcca48f58e00dc45e02b9782" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe></div>


<h2 id="researcher-experience-vs-developer-experience">Researcher Experience vs. Developer Experience</h2>
<p>The other big realization for this week was that we&rsquo;ve been allowing ourselves to get too cute with our demos. By building Arthropod to run against a whole suite of simultaneously-available software versions we were optimizing our library interfaces to support that. In fact, the simplest way to think about versioning your data is not to think about it at all.</p>
<p>As a result of this realization, we went back to the drawing board and started working out what the best <em>developer</em> experience would be, instead of a fun-to-demo <em>researcher</em> experience like we have right now.</p>
<h2 id="whats-next">What&rsquo;s next?</h2>
<p>Well, everything works&hellip; but nothing works very well. Now the long climb of the mountain begins in earnest. A brief list of things we don&rsquo;t support very well right now:</p>
<ul>
<li>arrays or maps (other than at the root of a document)</li>
<li>merging writes originating from clients running different versions of the software (oh, the irony)</li>
<li>writing lenses is a pain</li>
</ul>
<p>And oh, plenty of other problems. That said, we&rsquo;re probably not going to start with any of those (small) problems. We&rsquo;re going to go try and add some features to our issue tracker.</p>
<h2 id="hold-on-what">Hold on. What!?</h2>
<p>By forcing ourselves to &ldquo;eat the garbage&rdquo; (as friend-of-the-lab Kevin Lynagh likes to say) and figure out how to use this library in earnest, we&rsquo;ll naturally work through whichever of these issues is actually most annoying to a user, and undoubtedly discover some other problems along the way.</p>
<p>See you all next week!</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://inkandswitch.github.io/cambria/" >
    &copy;  Cambria Development Notes 2020 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/cambria/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
