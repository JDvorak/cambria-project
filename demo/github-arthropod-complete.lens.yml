# Convert a Github Issue into the Arthropod format
schemaName: Issue

lens:
  # remove unnecessary fields
  - remove: { destination: milestone }
  - remove: { destination: pull_request }
  - remove: { destination: closed_by }
  - remove: { destination: repository_url }
  - remove: { destination: number }
  - remove: { destination: assignees }
  - remove: { destination: user }
  - remove: { destination: url }
  - remove: { destination: comments_url }
  - remove: { destination: events_url }
  - remove: { destination: html_url }
  - remove: { destination: locked }
  - remove: { destination: active_lock_reason }
  - remove: { destination: comments }
  - remove: { destination: node_id }
  - remove: { destination: closed_at }

  # Some simple renames
  - rename:
      source: title
      destination: name
  - rename:
      source: body
      destination: description

  # Convert github's state field to our status field
  - rename:
      source: state
      destination: status
  - convert:
      destination: status
      mapping:
        - open: todo
          closed: done
        - todo: open
          doing: open
          done: closed

  # pull the creator up to the top level
  - in:
      source: user
      lens:
        - rename:
            source: login
            destination: created_by
  - hoist:
      destination: created_by
      host: user
  - remove: { destination: user }

  # pull first label up to category
  - head:
      destination: labels
  - in:
      source: labels
      lens:
        - rename:
            source: name
            destination: category
  - hoist:
      destination: category
      host: labels
  - remove:
      destination: labels

  # push created_at and updated_at inside a metadata object
  - add:
      destination: metadata
      type: object
  - plunge:
      destination: created_at
      host: metadata
  - plunge:
      destination: updated_at
      host: metadata
